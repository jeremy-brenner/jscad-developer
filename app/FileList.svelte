<script>    
    import File from './File.svelte';
    import { onMount } from 'svelte';
    import { createFileStore } from './stores.js';
    const watch = require('node-watch');

    const glob = require("glob")
    let modelDir = '../jscad-models';
    let show = true;
    let fileStores = [];

    const updateFileStatus = (type,url) => {
        const fileStore = fileStores.find( fileStore => fileStore.url() == url );
        if(fileStore) {
            fileStore.set({url,type})
        }else{
            fileStores.push(createFileStore({url,type}))
        }
    }

    onMount(() => {
        glob(`${modelDir}/**/*.jscad`, function (er, urls) {
            fileStores = urls.map(url => createFileStore({url,type: "unknown"}))
        });
        watch(modelDir, { recursive: true }, updateFileStatus );
    });

    function showHide() {
        show = !show;
    }
</script>

<div>
    <filelist class:show="{show}">
    {#each fileStores as fileStore}
        <File fileStore={fileStore}></File>
    {/each}
    </filelist>
    <showHide on:click="{showHide}">
        {#if show}
            &lt;
        {:else}
            &gt;
        {/if}
    </showHide>
</div>

<style>
    div {
        position: absolute;
        width: 100vw;
        height: 100vh;
        top: 0;
        left: 0;
        pointer-events:none; 
        touch-action:none;
    }

    filelist {
        width: 40%;
        height: 100%;
        display: none;
        border-right: 1px solid black;
        background-color: white;
        overflow-x: scroll;
    }

    filelist.show {
        display: inline-block;
        pointer-events: auto; 
        touch-action: auto;
    }
    
    showHide {      
        display: inline-block;
        position: absolute;
        top: 45%;
        border: 1px solid black;
        padding: 30px 3px 30px 3px;
        cursor: pointer;     
        background-color: white;
        pointer-events: auto; 
        touch-action: auto;
    }

</style>